let e=[[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0]],t=new class{constructor(t=e){if(this.board=t,this.score=0,this.newTile=null,this.mergedTiles=[],this.field=document.querySelector(".game-field"),!this.field)throw Error("Не знайдено елемент .game-field в DOM!");this.initBoard(),this.renderBoard()}filterZero(e){return e.filter(e=>0!==e)}initBoard(){this.cells=[],this.field.innerHTML="";for(let e=0;e<4;e++){this.cells[e]=[];for(let t=0;t<4;t++){let s=document.createElement("div");s.classList.add("field-cell"),this.field.appendChild(s),this.cells[e][t]=s}}}renderBoard(){for(let e=0;e<4;e++)for(let t=0;t<4;t++){let s=this.cells[e][t],r=this.board[e][t];s.textContent=r||"",s.className=`field-cell${r?` field-cell--${r}`:""}`,this.newTile&&this.newTile.row===e&&this.newTile.col===t&&(s.classList.add("field-cell--new"),s.addEventListener("animationend",()=>s.classList.remove("field-cell--new"),{once:!0}))}let e=document.querySelector(".game-score");e&&(e.textContent=String(this.score))}spawnNumber(){let e=[];for(let t=0;t<4;t++)for(let s=0;s<4;s++)0===this.board[t][s]&&e.push({row:t,col:s});if(0===e.length)return;let t=e[Math.floor(Math.random()*e.length)];this.board[t.row][t.col]=2,this.newTile=t,this.renderBoard(),this.newTile=null}isGameOver(){for(let e=0;e<4;e++)for(let t=0;t<4;t++)if(2048===this.board[e][t])return"win";for(let e=0;e<4;e++)for(let t=0;t<4;t++)if(0===this.board[e][t]||t<3&&this.board[e][t]===this.board[e][t+1]||e<3&&this.board[e][t]===this.board[e+1][t])return"playing";return"lose"}boardsAreEqual(e,t){for(let s=0;s<4;s++)for(let r=0;r<4;r++)if(e[s][r]!==t[s][r])return!1;return!0}moveLeft(){let e=JSON.parse(JSON.stringify(this.board));for(let e=0;e<4;e++){let t=this.board[e];t=this.filterZero(t);for(let s=0;s<t.length-1;s++)t[s]===t[s+1]&&(t[s]*=2,t[s+1]=0,this.score+=t[s],this.mergedTiles.push({row:e,col:s}));for(t=this.filterZero(t);t.length<4;)t.push(0);this.board[e]=t}this.renderBoard(),this.boardsAreEqual(e,this.board)||this.spawnNumber(),this.checkGameStatus()}moveRight(){let e=JSON.parse(JSON.stringify(this.board));for(let e=0;e<4;e++){let t=this.board[e].reverse();t=this.filterZero(t);for(let s=0;s<t.length-1;s++)t[s]===t[s+1]&&(t[s]*=2,t[s+1]=0,this.score+=t[s],this.mergedTiles.push({row:e,col:3-s}));for(t=this.filterZero(t);t.length<4;)t.push(0);this.board[e]=t.reverse()}this.renderBoard(),this.boardsAreEqual(e,this.board)||this.spawnNumber(),this.checkGameStatus()}moveUp(){let e=JSON.parse(JSON.stringify(this.board));this.mergedTiles=[];for(let e=0;e<4;e++){let t=[];for(let s=0;s<4;s++)t.push(this.board[s][e]);t=this.filterZero(t);for(let s=0;s<t.length-1;s++)t[s]===t[s+1]&&(t[s]*=2,t[s+1]=0,this.score+=t[s],this.mergedTiles.push({row:s,col:e}));for(t=this.filterZero(t);t.length<4;)t.push(0);for(let s=0;s<4;s++)this.board[s][e]=t[s]}this.renderBoard(),this.boardsAreEqual(e,this.board)||this.spawnNumber(),this.checkGameStatus()}moveDown(){let e=JSON.parse(JSON.stringify(this.board));this.mergedTiles=[];for(let e=0;e<4;e++){let t=[];for(let s=0;s<4;s++)t.push(this.board[s][e]);(t=this.filterZero(t)).reverse();for(let s=0;s<t.length-1;s++)t[s]===t[s+1]&&(t[s]*=2,t[s+1]=0,this.score+=t[s],this.mergedTiles.push({row:3-s,col:e}));for(t=this.filterZero(t);t.length<4;)t.push(0);t.reverse();for(let s=0;s<4;s++)this.board[s][e]=t[s]}this.renderBoard(),this.boardsAreEqual(e,this.board)||this.spawnNumber(),this.checkGameStatus()}getScore(){return this.score}getState(){return this.board}getStatus(){let e=document.querySelector(".message-container").querySelector("p:not(.hidden)");return e?e.classList.contains("message-start")?"idle":e.classList.contains("message-win")?"win":e.classList.contains("message-lose")?"lose":void 0:"playing"}checkGameStatus(){let e=this.isGameOver();("win"===e||"lose"===e)&&this.showMessage(e)}showMessage(e){document.querySelector(`.message.message-${e}`).classList.remove("hidden"),document.removeEventListener("keydown",this.boundKeyDown)}start(){this.initBoard(),this.spawnNumber(),this.spawnNumber(),document.querySelectorAll(".message").forEach(e=>e.classList.add("hidden")),this.boundKeyDown=this.keyDown.bind(this),document.addEventListener("keydown",this.boundKeyDown)}restart(){for(let e=0;e<4;e++)for(let t=0;t<4;t++){this.board[e][t]=0;let s=this.cells[e][t];s.textContent="",s.className="field-cell"}document.querySelector(".message.message-lose")?.classList.add("hidden"),document.querySelector(".message.message-win")?.classList.add("hidden"),document.querySelector(".message.message-start")?.classList.add("hidden"),document.removeEventListener("keydown",this.boundKeyDown),this.newTile=null,this.score=0,this.renderBoard(),this.spawnNumber(),this.spawnNumber(),this.boundKeyDown=this.keyDown.bind(this),document.addEventListener("keydown",this.boundKeyDown)}keyDown(e){switch(e.preventDefault(),e.key){case"ArrowUp":this.moveUp();break;case"ArrowDown":this.moveDown();break;case"ArrowLeft":this.moveLeft();break;case"ArrowRight":this.moveRight()}this.checkGameStatus()}},s=document.querySelector("button.start");s.addEventListener("click",()=>{"idle"===t.getStatus()?(s.classList.remove("start"),s.classList.add("restart"),s.textContent="Restart",t.start()):(s.classList.remove("start"),s.classList.add("restart"),s.textContent="Restart",t.restart())});
//# sourceMappingURL=2048-game.1cb1cba3.js.map
